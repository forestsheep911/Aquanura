# Internationalization (i18n) Guide

This template includes a complete internationalization example supporting four languages: English, Japanese, Simplified Chinese, and Traditional Chinese.

## Supported Languages

| Language | Code | manifest.json | Plugin Code |
|----------|------|---------------|-------------|
| English | `en` | âœ… | âœ… |
| Japanese | `ja` | âœ… | âœ… |
| Simplified Chinese | `zh` | âœ… | âœ… |
| Traditional Chinese | `zh-TW` | âœ… | âœ… |

## How It Works

### 1. Language Detection

The plugin automatically detects the user's language from Kintone:

```javascript
function getUserLanguage() {
  return kintone.getLoginUser().language || 'en';
}
```

Kintone returns language codes like:
- `en` - English
- `ja` - Japanese
- `zh` - Simplified Chinese
- `zh-TW` - Traditional Chinese

### 2. Message Storage

Messages are stored in a structured object:

```javascript
const messages = {
  en: {
    greeting: 'Hello from Kintone Plugin Template!',
    alertMessage: 'This is a sample plugin!',
  },
  ja: {
    greeting: 'Kintoneãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¸ã‚ˆã†ã“ãï¼',
    alertMessage: 'ã“ã‚Œã¯ã‚µãƒ³ãƒ—ãƒ«ã®Kintoneãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ï¼',
  },
  zh: {
    greeting: 'æ¬¢è¿ä½¿ç”¨Kintoneæ’ä»¶æ¨¡æ¿ï¼',
    alertMessage: 'è¿™æ˜¯ä¸€ä¸ªKintoneç¤ºä¾‹æ’ä»¶ï¼',
  },
  'zh-TW': {
    greeting: 'æ­¡è¿ä½¿ç”¨Kintoneå¤–æ›ç¨‹å¼ç¯„æœ¬ï¼',
    alertMessage: 'é€™æ˜¯ä¸€å€‹Kintoneç¯„ä¾‹å¤–æ›ç¨‹å¼ï¼',
  },
};
```

### 3. Translation Function

A simple `t()` function retrieves the correct message:

```javascript
function t(key) {
  const lang = getUserLanguage();
  return messages[lang]?.[key] || messages.en[key] || key;
}
```

Fallback behavior:
1. Try user's language
2. Fall back to English
3. Return the key if neither exists

### 4. Usage in Code

```javascript
// In JavaScript
const message = t('greeting');
alert(t('alertMessage'));

// In HTML (using data attributes)
container.innerHTML = `
  <div>${t('greeting')}</div>
`;
```

## Adding a New Language

### Step 1: Update `manifest.json`

```json
{
  "name": {
    "en": "Plugin Name",
    "ja": "ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å",
    "zh": "æ’ä»¶åç§°",
    "zh-TW": "å¤–æ›ç¨‹å¼åç¨±",
    "ko": "í”ŒëŸ¬ê·¸ì¸ ì´ë¦„"  // Add Korean
  }
}
```

### Step 2: Add Messages to Plugin Code

In `plugin/src/logic/desktop/desktop.js`:

```javascript
const messages = {
  en: { greeting: 'Hello!' },
  ja: { greeting: 'ã“ã‚“ã«ã¡ã¯ï¼' },
  zh: { greeting: 'ä½ å¥½ï¼' },
  'zh-TW': { greeting: 'ä½ å¥½ï¼' },
  ko: { greeting: 'ì•ˆë…•í•˜ì„¸ìš”!' },  // Add Korean
};
```

In `plugin/src/logic/config/config.js`:

```javascript
const messages = {
  en: { title: 'Configuration' },
  ja: { title: 'è¨­å®š' },
  zh: { title: 'é…ç½®' },
  'zh-TW': { title: 'è¨­å®š' },
  ko: { title: 'êµ¬ì„±' },  // Add Korean
};
```

### Step 3: Test

1. Change your Kintone user language in Settings
2. Reload the plugin
3. Verify all text displays in the correct language

## Configuration Page i18n

The configuration page uses a data-attribute approach for automatic translation:

### HTML Structure

```html
<h1 data-i18n="title">ğŸ”Œ Plugin Configuration</h1>
<input data-i18n-placeholder="messagePlaceholder" placeholder="Enter message...">
```

### Automatic Translation

On page load, this function runs:

```javascript
function applyI18n() {
  // Translate text content
  for (const el of document.querySelectorAll('[data-i18n]')) {
    const key = el.getAttribute('data-i18n');
    el.textContent = t(key);
  }

  // Translate placeholders
  for (const el of document.querySelectorAll('[data-i18n-placeholder]')) {
    const key = el.getAttribute('data-i18n-placeholder');
    el.placeholder = t(key);
  }
}
```

## Best Practices

### 1. Always Provide English Fallback

```javascript
// âœ… Good - has English fallback
return messages[lang]?.[key] || messages.en[key] || key;

// âŒ Bad - no fallback
return messages[lang][key];
```

### 2. Use Meaningful Keys

```javascript
// âœ… Good - descriptive keys
const messages = {
  en: {
    saveButton: 'Save',
    deleteConfirm: 'Are you sure you want to delete?',
  }
};

// âŒ Bad - unclear keys
const messages = {
  en: {
    btn1: 'Save',
    msg1: 'Are you sure you want to delete?',
  }
};
```

### 3. Keep Messages in One Place

```javascript
// âœ… Good - centralized messages
const messages = { ... };
function t(key) { ... }

// âŒ Bad - scattered strings
alert('Configuration saved!');  // Hardcoded
console.log('Error occurred');  // Hardcoded
```

### 4. Handle Plurals and Variables

```javascript
// For messages with variables
const messages = {
  en: {
    itemCount: (n) => `${n} item${n !== 1 ? 's' : ''}`,
  },
  ja: {
    itemCount: (n) => `${n}å€‹ã®ã‚¢ã‚¤ãƒ†ãƒ `,
  }
};

// Usage
console.log(messages.en.itemCount(1));  // "1 item"
console.log(messages.en.itemCount(5));  // "5 items"
console.log(messages.ja.itemCount(5));  // "5å€‹ã®ã‚¢ã‚¤ãƒ†ãƒ "
```

## Language-Specific Considerations

### Japanese
- Use polite forms (ã§ã™ãƒ»ã¾ã™ä½“) in user-facing text
- Consider kanji vs hiragana readability
- Format dates as YYYY/MM/DD

### Chinese (Simplified)
- Use mainland China terminology
- Prefer simplified characters
- Format dates as YYYYå¹´MMæœˆDDæ—¥

### Chinese (Traditional)
- Taiwan/Hong Kong terminology may differ
- Use traditional characters
- Different word choices (e.g., "æ’ä»¶" vs "å¤–æ›ç¨‹å¼")

### English
- Use clear, concise language
- Avoid idioms that don't translate well
- Format dates as MM/DD/YYYY or ISO 8601

## Testing i18n

### Manual Testing

1. **Change User Language**
   ```
   Kintone Settings â†’ Personal Settings â†’ Language
   ```

2. **Test Each Screen**
   - Plugin list page (manifest names/descriptions)
   - Configuration page (all labels, buttons, placeholders)
   - Desktop view (messages, alerts)
   - Mobile view (if different)

3. **Test Fallbacks**
   - Remove a message from one language
   - Verify it falls back to English

### Automated Testing

```javascript
// Test language detection
describe('getUserLanguage', () => {
  it('returns user language from Kintone', () => {
    kintone.getLoginUser = () => ({ language: 'ja' });
    expect(getUserLanguage()).toBe('ja');
  });

  it('falls back to English if not set', () => {
    kintone.getLoginUser = () => ({ language: null });
    expect(getUserLanguage()).toBe('en');
  });
});

// Test translation function
describe('t', () => {
  it('returns translated message', () => {
    expect(t('greeting')).toBe('Hello from Kintone Plugin Template!');
  });

  it('falls back to English if language not found', () => {
    // User language is 'ko' but no Korean translations
    expect(t('greeting')).toBe('Hello from Kintone Plugin Template!');
  });
});
```

## Common Pitfalls

### âŒ Don't Do This

```javascript
// Hardcoded strings
alert('Configuration saved!');

// Language detection in wrong place
const lang = getUserLanguage();  // Called at module load
// User changes language â†’ still uses old value

// Missing fallback
return messages[lang][key];  // Throws error if undefined

// Mixing languages
const messages = {
  en: { greeting: 'Hello', farewell: 'ã•ã‚ˆã†ãªã‚‰' }  // Don't mix!
};
```

### âœ… Do This Instead

```javascript
// Use translation function
alert(t('saveSuccess'));

// Detect language at runtime
function t(key) {
  const lang = getUserLanguage();  // Fresh on every call
  return messages[lang]?.[key] || messages.en[key] || key;
}

// Always have fallback
return messages[lang]?.[key] || messages.en[key] || key;

// Keep languages pure
const messages = {
  en: { greeting: 'Hello', farewell: 'Goodbye' },
  ja: { greeting: 'ã“ã‚“ã«ã¡ã¯', farewell: 'ã•ã‚ˆã†ãªã‚‰' }
};
```

## Resources

- [Kintone API - getLoginUser()](https://developer.cybozu.io/hc/ja/articles/202166330)
- [ISO 639-1 Language Codes](https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes)
- [i18n Best Practices](https://www.w3.org/International/questions/qa-i18n)

## Contributing Translations

Want to add more languages? Please:

1. Add language to `manifest.json`
2. Add translations to `desktop.js` and `config.js`
3. Test thoroughly
4. Submit a pull request!

Common language requests:
- Korean (`ko`)
- Thai (`th`)
- Vietnamese (`vi`)
- Indonesian (`id`)
- German (`de`)
- French (`fr`)
- Spanish (`es`)









